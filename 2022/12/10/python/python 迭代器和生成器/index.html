<!DOCTYPE html>
<html>
  <head>
     
    <meta charset="UTF-8">
    <title>python 迭代器和生成器 - onepiece</title>
    <link rel="shortcut icon" href="/static/img/icon.png">
    <link rel="icon" href="/static/img/icon.png" sizes="192x192"/>
    
<link rel="stylesheet" href="/static/kico.css">
<link rel="stylesheet" href="/static/hingle.css">

    
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <meta name="viewport" content="width=device-width, maximum-scale=1, initial-scale=1"/>
    <meta property="og:site_name" content="onepiece">
    <meta property="og:title" content="python 迭代器和生成器"/>
    
    <style>body:before{ content: ''; background-image: url(https://github.com/junliangl/hexo-back/blob/master/images/images/%E6%9D%8F%E6%9E%9D.jpg?raw=true) }</style>
    
<meta name="generator" content="Hexo 6.3.0"></head>

  <body class="dark-theme">
    <header>
    <div class="head-title">
        <h4>onepiece</h4>
    </div>
    <div class="head-action">
        <div class="toggle-btn"></div>
        <div class="light-btn"></div>
        <div class="search-btn"></div>
    </div>
    <form class="head-search" method="post">
        <input type="text" name="s" placeholder="暂时不支持搜索哦">
    </form>
    <nav class="head-menu">
        <a href="/">首页</a>
        <div class="has-child">
            <a>分类</a>
            <div class="sub-menu">
				<a href="/categories/python/">python</a>
				<a href="/categories/linux">linux</a>
				<a href="/categories/test">测试</a>
            </div>
        </div>
        
            <a href="/about">关于我</a>
        
    </nav>
</header>

    <main>
    <div class="wrap min">
        <section class="post-title">
            <h2>python 迭代器和生成器</h2>
            <div class="post-meta">
                <time class="date">2022.12.10</time>
            
                <span class="category"><a class="category-link" href="/categories/python/">python</a></span>
            
            </div>
        </section>
        <article class="post-content">
        
            <h1 id="迭代器（iterator）"><a href="#迭代器（iterator）" class="headerlink" title="迭代器（iterator）"></a>迭代器（iterator）</h1><p>python 独有的一种数据类型。要理清迭代器是什么，首先得弄懂什么要可迭代（iterable）</p>
<h2 id="可迭代类与可迭代对象"><a href="#可迭代类与可迭代对象" class="headerlink" title="可迭代类与可迭代对象"></a>可迭代类与可迭代对象</h2><p>python 规定如果一个类定义了一个 <code>__iter__()</code> 的魔法方法的话，那么这个类就是 可迭代类，它的实例化对象就是一个 可迭代对象</p>
<p>我们可以导入 <code>collections</code> 包的 <code>abc</code> 模块查看某个对象是否是 <code>Iterable</code> 的</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> abc</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestIterable</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__iter__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line"></span><br><span class="line">    iterable = TestIterable()</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">isinstance</span>(iterable, abc.Iterable))</span><br></pre></td></tr></table></figure>

<p>返回</p>
<p><img src="/./images/python/iterator/1.png"></p>
<p>从上面我们可以看到，类 <code>TestIterable</code> 定义了一个 <code>__iter__()</code> 方法，并且要返回一个对象，这里是它本身，那么 <code>TestIterable</code> 类就被称为 可迭代类，它的对象 <code>iterable</code> 就被称为 可迭代对象</p>
<h3 id="可迭代对象的-iter-方法"><a href="#可迭代对象的-iter-方法" class="headerlink" title="可迭代对象的 __iter()__方法"></a>可迭代对象的 <code>__iter()__</code>方法</h3><p>由于 <code>__iter__()</code> 是可迭代对象的方法，那么它本身可以调用它</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">TestIterable</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__iter__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;我是可迭代对象的 __iter__() 方法&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line"></span><br><span class="line">    iterable = TestIterable()</span><br><span class="line">    iterable.__iter__()</span><br></pre></td></tr></table></figure>

<p>返回</p>
<p><img src="/./images/python/iterator/2.png"></p>
<h3 id="内置函数-iter"><a href="#内置函数-iter" class="headerlink" title="内置函数 iter()"></a>内置函数 <code>iter()</code></h3><p>python 提供一个内置方法 <code>iter()</code> 方法可以直接调用对象的 <code>__iter__()</code> 方法</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">TestIterable</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__iter__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;我是可迭代对象的 __iter__() 方法&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line"></span><br><span class="line">    iterable = TestIterable()</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="built_in">iter</span>(iterable)</span><br><span class="line">    <span class="keyword">except</span> TypeError <span class="keyword">as</span> t:</span><br><span class="line">        <span class="built_in">print</span>(t)</span><br></pre></td></tr></table></figure>

<p>返回</p>
<p><img src="/./images/python/iterator/3.png"></p>
<ul>
<li>以上不难发现，<code>iter()</code> 方法确实是调用了 <code>__iter__()</code> 方法，但是本身抛出了一个异常，因为返回值不是一个 迭代器，而是一个无类型的 None</li>
</ul>
<h3 id="对-for-循环进行重新认识"><a href="#对-for-循环进行重新认识" class="headerlink" title="对 for 循环进行重新认识"></a>对 for 循环进行重新认识</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">test_iterable</span>():</span><br><span class="line">    test_list = [<span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line">    test_tuple = (<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">    test_dict = &#123;<span class="number">1</span>:<span class="string">&quot;FIRST&quot;</span>, <span class="number">2</span>:<span class="string">&quot;SECOND&quot;</span>&#125;</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> test_list:</span><br><span class="line">        <span class="built_in">print</span>(i)</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> test_tuple:</span><br><span class="line">        <span class="built_in">print</span>(j)</span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> test_dict:</span><br><span class="line">        <span class="built_in">print</span>(k)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    test_iterable()</span><br></pre></td></tr></table></figure>

<p>是什么能让 <code>list</code>，<code>tuple</code>，<code>dict</code> 进行 for in 循环呢。答案是 <code>list</code>，<code>tuple</code>，<code>dict</code> 是可迭代类，理由如下</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">test_iterable</span>():</span><br><span class="line">    test_list = [<span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line">    test_tuple = (<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">    test_dict = &#123;<span class="number">1</span>:<span class="string">&quot;FIRST&quot;</span>, <span class="number">2</span>:<span class="string">&quot;SECOND&quot;</span>&#125;</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">dir</span>(test_list))</span><br><span class="line">    <span class="built_in">print</span>()</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">dir</span>(test_tuple))</span><br><span class="line">    <span class="built_in">print</span>()</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">dir</span>(test_dict))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    test_iterable()</span><br></pre></td></tr></table></figure>

<p>通过内置 <code>dir()</code> 找到三个不同对象所有的类属性</p>
<p><img src="/./images/python/iterator/4.png"></p>
<ul>
<li>注意到这三个类都定义了 <code>__iter__()</code> 方法，所以他们的对象才都时可迭代的，因此才能被 for in 循环遍历</li>
</ul>
<h3 id="可迭代对象进行-for-循环"><a href="#可迭代对象进行-for-循环" class="headerlink" title="可迭代对象进行 for 循环"></a>可迭代对象进行 for 循环</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">TestIterable</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__iter__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;我是可迭代对象的 __iter__() 方法&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line"></span><br><span class="line">    iterable = TestIterable()</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> iterable:</span><br><span class="line">            <span class="built_in">print</span>(i)</span><br><span class="line">    <span class="keyword">except</span> TypeError <span class="keyword">as</span> t:</span><br><span class="line">        <span class="built_in">print</span>(t)</span><br></pre></td></tr></table></figure>

<p>返回</p>
<p><img src="/./images/python/iterator/5.png"></p>
<ul>
<li>可以看到 for in 循环和 <code>iter()</code> 方法一样，同样调用了 <code>__iter__()</code> 方法，并且也会提示抛出了一个异常，因为返回值不是一个 迭代器，而是一个无类型的 None。以下讲解什么是迭代器</li>
</ul>
<h2 id="迭代类和迭代器"><a href="#迭代类和迭代器" class="headerlink" title="迭代类和迭代器"></a>迭代类和迭代器</h2><p>了解完可迭代类和可迭代对象后，我们对迭代类和迭代器作出讲解</p>
<p>python 规定一个类如果同时定义了 <code>__iter__()</code> 和 <code>__next__()</code>方法时，那么我们就称这个类为迭代类或者叫迭代器类，同理它的对象被称为 迭代对象 或者叫 迭代器</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> abc</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestIterator</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__iter__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__next__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    iterator = TestIterator()</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">isinstance</span>(iterator, abc.Iterable))</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">isinstance</span>(iterator, abc.Iterator))</span><br></pre></td></tr></table></figure>

<p>返回</p>
<p><img src="/./images/python/iterator/6.png"></p>
<ul>
<li>发现迭代器依旧本身也是一个可迭代对象，因为它的类同样包含 <code>__iter__()</code> 方法，不同的是，它还是迭代器，因为其中包含 <code>__next__()</code> 方法</li>
</ul>
<h3 id="对迭代器对象的-iter"><a href="#对迭代器对象的-iter" class="headerlink" title="对迭代器对象的 iter()"></a>对迭代器对象的 <code>iter()</code></h3><p>首先，我们对迭代器对象进行 <code>iter()</code>方法处理</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">TestIterator</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__iter__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__next__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    iterator = TestIterator()</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">iter</span>(iterator))</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">type</span>(<span class="built_in">iter</span>(iterator)))</span><br></pre></td></tr></table></figure>

<p>返回</p>
<p><img src="/./images/python/iterator/7.png"></p>
<ul>
<li>会发现这次和上面可迭代对象不同的是，迭代器由于返回的 self 本身是迭代器，所以，<code>iter()</code> 方法并没有报错</li>
</ul>
<h3 id="迭代器调用-next-方法"><a href="#迭代器调用-next-方法" class="headerlink" title="迭代器调用 __next__()方法"></a>迭代器调用 <code>__next__()</code>方法</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">TestIterator</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__iter__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__next__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;这是迭代器的 __next__() 方法&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    iterator = TestIterator()</span><br><span class="line">    iterator.__next__()</span><br></pre></td></tr></table></figure>

<p>返回</p>
<p><img src="/./images/python/iterator/8.png"></p>
<p>同理，<code>__next__()</code> 方法也有内置方法 <code>next()</code> 方法作为快速调用</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">TestIterator</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__iter__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__next__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;这是迭代器的 __next__() 方法&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    iterator = TestIterator()</span><br><span class="line">    <span class="built_in">next</span>(iterator)</span><br></pre></td></tr></table></figure>

<p>返回</p>
<p><img src="/./images/python/iterator/9.png"></p>
<h3 id="对迭代器的-for-in-循环"><a href="#对迭代器的-for-in-循环" class="headerlink" title="对迭代器的 for in 循环"></a>对迭代器的 for in 循环</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">TestIterator</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__iter__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__next__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;这是迭代器的 __next__() 方法&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    iterator = TestIterator()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> iterator:</span><br><span class="line">        <span class="built_in">print</span>(i)</span><br></pre></td></tr></table></figure>

<p>返回</p>
<p><img src="/./images/python/iterator/10.png"></p>
<p>你会发现陷入了死循环</p>
<ul>
<li><p>原因如下：</p>
</li>
<li><p><code>for i in iterable</code> 内部先调用了 <code>iter(iterable)</code> 方法返回一个迭代器的对象 iterator，再循环调用 <code>next(iterator)</code> 方法，这也是为什么会陷入死循环的原因</p>
</li>
</ul>
<h3 id="解决-for-in-死循环"><a href="#解决-for-in-死循环" class="headerlink" title="解决 for in 死循环"></a>解决 for in 死循环</h3><p>要想不陷入死循环，我们按照官方的定义，在 <code>__next__()</code> 方法 <code>raise</code> 一个 <code>StopIteration</code> 异常就可以</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">TestIterator</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__iter__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__next__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;这是迭代器的 __next__() 方法&quot;</span>)</span><br><span class="line">        <span class="keyword">raise</span> StopIteration(<span class="string">&quot;循环结束&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    iterator = TestIterator()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> iterator:</span><br><span class="line">        <span class="built_in">print</span>(i)</span><br></pre></td></tr></table></figure>

<p>返回</p>
<p><img src="/./images/python/iterator/11.png"></p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>综上所诉，for in 循环后的对象一定要是可迭代对象，在 python 中，可迭代对象分为 纯可迭代对象和迭代器。所以，要想 for in 循环不报错，那么可迭代对象的 <code>__iter__()</code> 方法一定返回的是一个迭代器，而迭代器的 <code>__iter__()</code> 方法返回对的绝对多数情况是它本身 self，且 <code>__next__()</code> 配合 <code>raise StopIteration</code> 可以终止循环</p>
<h2 id="自定义-range-方法"><a href="#自定义-range-方法" class="headerlink" title="自定义 range() 方法"></a>自定义 <code>range()</code> 方法</h2><p>以下是基于可迭代对象和迭代器写的一个新的简单的 <code>range()</code> 方法</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">RangeIterator</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, number: <span class="built_in">int</span></span>):</span><br><span class="line">        self.number = number</span><br><span class="line">        self.__count = -<span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__iter__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__next__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> self.__count &lt; self.number - <span class="number">1</span>:</span><br><span class="line">            self.__count += <span class="number">1</span></span><br><span class="line">            <span class="keyword">return</span> self.__count</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> StopIteration</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NewRange</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, number: <span class="built_in">int</span></span>):</span><br><span class="line">        self.number = number</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__iter__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> RangeIterator(self.number)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> NewRange(<span class="number">0</span>):</span><br><span class="line">        <span class="built_in">print</span>(i)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;*&quot;</span>*<span class="number">30</span>)</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> NewRange(<span class="number">5</span>):</span><br><span class="line">        <span class="built_in">print</span>(j)</span><br></pre></td></tr></table></figure>

<p>返回</p>
<p><img src="/./images/python/iterator/12.png"></p>
<h2 id="迭代器实现-range"><a href="#迭代器实现-range" class="headerlink" title="迭代器实现 range()"></a>迭代器实现 <code>range()</code></h2><p>同理，因为迭代器本身也是可迭代对象，那么只用迭代器类也可以实现 <code>range()</code> 循环</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">NewRange</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, number: <span class="built_in">int</span></span>):</span><br><span class="line">        self.number = number</span><br><span class="line">        self.__count = -<span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__iter__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__next__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> self.__count &lt; self.number - <span class="number">1</span>:</span><br><span class="line">            self.__count += <span class="number">1</span></span><br><span class="line">            <span class="keyword">return</span> self.__count</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> StopIteration</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> NewRange(<span class="number">0</span>):</span><br><span class="line">        <span class="built_in">print</span>(i)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;*&quot;</span>*<span class="number">30</span>)</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> NewRange(<span class="number">5</span>):</span><br><span class="line">        <span class="built_in">print</span>(j)</span><br></pre></td></tr></table></figure>

<p>返回</p>
<p><img src="/./images/python/iterator/13.png"></p>
<h2 id="可迭代对象实现单向链表"><a href="#可迭代对象实现单向链表" class="headerlink" title="可迭代对象实现单向链表"></a>可迭代对象实现单向链表</h2><p>以下是基于迭代器实现单向链表</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">NodeIterator</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, node_obj</span>):</span><br><span class="line">        self.node_obj = node_obj</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__iter__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__next__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> self.node_obj:</span><br><span class="line">            name = self.node_obj.name</span><br><span class="line">            self.node_obj = self.node_obj.<span class="built_in">next</span></span><br><span class="line">            <span class="keyword">return</span> name</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> StopIteration</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NodeIterable</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name</span>):</span><br><span class="line">        self.name = name</span><br><span class="line">        self.<span class="built_in">next</span> = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__iter__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> NodeIterator(self)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line"></span><br><span class="line">    node1 = NodeIterable(<span class="string">&quot;first&quot;</span>)</span><br><span class="line">    node2 = NodeIterable(<span class="string">&quot;second&quot;</span>)</span><br><span class="line">    node3 = NodeIterable(<span class="string">&quot;third&quot;</span>)</span><br><span class="line"></span><br><span class="line">    node1.<span class="built_in">next</span> = node2</span><br><span class="line">    node2.<span class="built_in">next</span> = node3</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> node <span class="keyword">in</span> node1:</span><br><span class="line">        <span class="built_in">print</span>(node)</span><br></pre></td></tr></table></figure>

<p>返回</p>
<p><img src="/./images/python/iterator/14.png"></p>
<h2 id="迭代器实现单向链表"><a href="#迭代器实现单向链表" class="headerlink" title="迭代器实现单向链表"></a>迭代器实现单向链表</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Node</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name</span>):</span><br><span class="line">        self.name = name</span><br><span class="line">        self.<span class="built_in">next</span> = <span class="literal">None</span></span><br><span class="line">        self.obj = self</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__iter__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__next__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> self.obj:</span><br><span class="line">            nodes = self.obj.name</span><br><span class="line">            self.obj = self.obj.<span class="built_in">next</span></span><br><span class="line">            <span class="keyword">return</span> nodes</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> StopIteration</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    node1 = Node(<span class="string">&quot;first&quot;</span>)</span><br><span class="line">    node2 = Node(<span class="string">&quot;second&quot;</span>)</span><br><span class="line">    node3 = Node(<span class="string">&quot;third&quot;</span>)</span><br><span class="line"></span><br><span class="line">    node1.<span class="built_in">next</span> = node2</span><br><span class="line">    node2.<span class="built_in">next</span> = node3</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> node <span class="keyword">in</span> node1:</span><br><span class="line">        <span class="built_in">print</span>(node)</span><br></pre></td></tr></table></figure>

<p>返回</p>
<p><img src="/./images/python/iterator/15.png"></p>
<ul>
<li>next 指针指向的始终是下一个对象，如果判定 <code>self.obj.next</code> 指向的下一个对象是 None，即没有下一个对象，那么遍历整个链表成功</li>
</ul>
<h2 id="通过迭代器解决环链问题"><a href="#通过迭代器解决环链问题" class="headerlink" title="通过迭代器解决环链问题"></a>通过迭代器解决环链问题</h2><p>class Node:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name</span>):</span><br><span class="line">    self.name = name</span><br><span class="line">    self.<span class="built_in">next</span> = <span class="literal">None</span></span><br><span class="line">    self.flag = <span class="number">0</span>  <span class="comment"># 设置一个标志</span></span><br><span class="line">    self.fast = self  <span class="comment"># 设置两个从相同节点出发速度不同的指针</span></span><br><span class="line">    self.slow = self</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">__iter__</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="keyword">return</span> self</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">__next__</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="comment"># 如果遍历多次出现了快慢指针一样,说明必然有环</span></span><br><span class="line">    <span class="keyword">if</span> self.flag == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">raise</span> StopIteration</span><br><span class="line">    <span class="comment"># 如果标志位为2直接跳出循环</span></span><br><span class="line">    <span class="keyword">if</span> self.flag == <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">raise</span> StopIteration</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        self.fast = self.fast.<span class="built_in">next</span>.<span class="built_in">next</span></span><br><span class="line">        self.slow = self.slow.<span class="built_in">next</span></span><br><span class="line">    <span class="comment"># 如果有报错,说明必然无环,设置标志位为2</span></span><br><span class="line">    <span class="keyword">except</span> AttributeError:</span><br><span class="line">        self.flag = <span class="number">2</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">if</span> self.fast == self.slow:</span><br><span class="line">        self.flag = <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    head = Node(<span class="string">&quot;first&quot;</span>)</span><br><span class="line">    node2 = Node(<span class="string">&quot;second&quot;</span>)</span><br><span class="line">    node3 = Node(<span class="string">&quot;third&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 设置无环链表</span></span><br><span class="line">    head.<span class="built_in">next</span> = node2</span><br><span class="line">    node2.<span class="built_in">next</span> = node3</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> node <span class="keyword">in</span> head:</span><br><span class="line">        <span class="keyword">if</span> node <span class="keyword">is</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;该链表是环链&quot;</span>)</span><br><span class="line">        <span class="keyword">elif</span> node <span class="keyword">is</span> <span class="literal">False</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;该链表不是环链&quot;</span>)</span><br><span class="line"></span><br><span class="line">    head = Node(<span class="string">&quot;first&quot;</span>)</span><br><span class="line">    node2 = Node(<span class="string">&quot;second&quot;</span>)</span><br><span class="line">    node3 = Node(<span class="string">&quot;third&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 设置一个有环链表</span></span><br><span class="line">    head.<span class="built_in">next</span> = node2</span><br><span class="line">    node2.<span class="built_in">next</span> = node3</span><br><span class="line">    node3.<span class="built_in">next</span> = head</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> node <span class="keyword">in</span> head:</span><br><span class="line">        <span class="keyword">if</span> node <span class="keyword">is</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;该链表是环链&quot;</span>)</span><br><span class="line">        <span class="keyword">elif</span> node <span class="keyword">is</span> <span class="literal">False</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;该链表不是环链&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>返回</p>
<p><img src="/./images/python/iterator/16.png"></p>
<h1 id="生成器（generator）"><a href="#生成器（generator）" class="headerlink" title="生成器（generator）"></a>生成器（generator）</h1><p>如果一个方法中拥有关键字 <code>yield</code>，不管这个 <code>yield</code> 关键字位置在哪，那么这个方法就被称为生成器。因为方法加载需要在方法区，方法区识别有 <code>yield</code> 后，会在堆中创建一个生成器 （generator）</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">generator</span>():</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">yield</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">type</span>(generator()))</span><br></pre></td></tr></table></figure>

<p>返回</p>
<p><img src="/./images/python/iterator/17.png"></p>
<h2 id="yield-关键字"><a href="#yield-关键字" class="headerlink" title="yield 关键字"></a><code>yield</code> 关键字</h2><p><code>yield</code> 关键字的作用是，当调用方法时，会创建一个生成器对象，并不会运行方法。如果调用 <code>next()</code> 方法时，会先执行方法直到碰到一个 <code>yield</code>，并将一个 <code>yield</code> 返回值作为第一返回值返回，如果再次调用 <code>next()</code> 方法时，依旧会执行接下的代码直到碰到下一个 <code>yield</code>，并返回值，如果没有碰到 <code>yield</code>，则会抛出 <code>StopIteration</code> 异常</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">generator</span>(<span class="params">number</span>):</span><br><span class="line">    <span class="keyword">while</span> number &lt; <span class="number">3</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;begin&quot;</span>)</span><br><span class="line">        <span class="keyword">yield</span> number</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;end&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>()</span><br><span class="line">        number += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    generator = generator(<span class="number">0</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">next</span>(generator))</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">next</span>(generator))</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">next</span>(generator))</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">next</span>(generator))</span><br></pre></td></tr></table></figure>

<p>返回</p>
<p><img src="/./images/python/iterator/18.png"></p>
<h2 id="生成器与迭代器关系"><a href="#生成器与迭代器关系" class="headerlink" title="生成器与迭代器关系"></a>生成器与迭代器关系</h2><p>生成器是一个特殊的迭代器，可以被 for in 循环遍历</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">generator</span>(<span class="params">number</span>):</span><br><span class="line">    <span class="keyword">while</span> number &lt; <span class="number">3</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;begin&quot;</span>)</span><br><span class="line">        <span class="keyword">yield</span> number</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;end&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>()</span><br><span class="line">        number += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    generator = generator(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> generator:</span><br><span class="line">        <span class="built_in">print</span>(i)</span><br></pre></td></tr></table></figure>

<p>返回</p>
<p><img src="/./images/python/iterator/19.png"></p>
<ul>
<li>该 for in 循环相当于每次都对 <code>generator</code> 进行一次 <code>next()</code> 方法操作，只是最后一步不会抛出异常</li>
</ul>
<h2 id="yield-语句返回值"><a href="#yield-语句返回值" class="headerlink" title="yield 语句返回值"></a><code>yield</code> 语句返回值</h2><p><code>yield</code> 语句本身也有值，但是默认为 None</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">generator</span>(<span class="params">number</span>):</span><br><span class="line">    <span class="keyword">while</span> number &lt; <span class="number">3</span>:</span><br><span class="line">        a = <span class="keyword">yield</span> number</span><br><span class="line">        number += <span class="number">1</span></span><br><span class="line">        <span class="built_in">print</span>(a)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    generator = generator(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> generator:</span><br><span class="line">        <span class="built_in">print</span>(i)</span><br></pre></td></tr></table></figure>

<p>返回</p>
<p><img src="/./images/python/iterator/20.png"></p>
<ul>
<li>你会发现，a 的值永远是 None</li>
</ul>
<h2 id="send-方法"><a href="#send-方法" class="headerlink" title="send() 方法"></a><code>send()</code> 方法</h2><p>通过 <code>send()</code> 方法修改 <code>yield</code> 返回值</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">generator</span>(<span class="params">number</span>):</span><br><span class="line">    <span class="keyword">while</span> number &lt; <span class="number">3</span>:</span><br><span class="line">        a = <span class="keyword">yield</span> number</span><br><span class="line">        number += <span class="number">1</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;a的值是<span class="subst">&#123;a&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    generator = generator(<span class="number">0</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">next</span>(generator))</span><br><span class="line">    <span class="built_in">print</span>()</span><br><span class="line">    <span class="built_in">print</span>(generator.send(<span class="number">3</span>))</span><br></pre></td></tr></table></figure>

<p>返回</p>
<p><img src="/./images/python/iterator/21.png"></p>
<h2 id="send-方法本质"><a href="#send-方法本质" class="headerlink" title="send() 方法本质"></a><code>send()</code> 方法本质</h2><p> <code>send()</code> 方法本质就是 <code>next()</code> 方法，不过是让 yield 语句有值罢了。所以 <code>next()</code> 语句相当于 <code>send(None)</code>，但是不能初始时给生成器传值</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">generator</span>(<span class="params">number</span>):</span><br><span class="line">    <span class="keyword">while</span> number &lt; <span class="number">3</span>:</span><br><span class="line">        a = <span class="keyword">yield</span> number</span><br><span class="line">        number += <span class="number">1</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;a的值是<span class="subst">&#123;a&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    generator = generator(<span class="number">0</span>)</span><br><span class="line">    <span class="built_in">print</span>(generator.send(<span class="number">3</span>))</span><br></pre></td></tr></table></figure>

<p>返回</p>
<p><img src="/./images/python/iterator/22.png"></p>
<h2 id="生成器完定义range-方法"><a href="#生成器完定义range-方法" class="headerlink" title="生成器完定义range() 方法"></a>生成器完定义<code>range()</code> 方法</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">range_generator</span>(<span class="params">number</span>):</span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> count &lt; number:</span><br><span class="line">        <span class="keyword">yield</span> count</span><br><span class="line">        count += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range_generator(<span class="number">5</span>):</span><br><span class="line">        <span class="built_in">print</span>(i)</span><br></pre></td></tr></table></figure>

<p>返回</p>
<p><img src="/./images/python/iterator/23.png"></p>
<h2 id="生成器完成单向链表"><a href="#生成器完成单向链表" class="headerlink" title="生成器完成单向链表"></a>生成器完成单向链表</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Node</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name</span>):</span><br><span class="line">        self.name = name</span><br><span class="line">        self.<span class="built_in">next</span> = <span class="literal">None</span></span><br><span class="line">        self.obj = self</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__iter__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">while</span> self.obj:</span><br><span class="line">            <span class="keyword">yield</span> self.obj.name</span><br><span class="line">            self.obj = self.obj.<span class="built_in">next</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    node1 = Node(<span class="string">&quot;first&quot;</span>)</span><br><span class="line">    node2 = Node(<span class="string">&quot;second&quot;</span>)</span><br><span class="line">    node3 = Node(<span class="string">&quot;third&quot;</span>)</span><br><span class="line"></span><br><span class="line">    node1.<span class="built_in">next</span> = node2</span><br><span class="line">    node2.<span class="built_in">next</span> = node3</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> node1:</span><br><span class="line">        <span class="built_in">print</span>(i)</span><br></pre></td></tr></table></figure>

<p>返回</p>
<p><img src="/./images/python/iterator/24.png"></p>
<h2 id="利用生成器判定是否是环链表"><a href="#利用生成器判定是否是环链表" class="headerlink" title="利用生成器判定是否是环链表"></a>利用生成器判定是否是环链表</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Node</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name</span>):</span><br><span class="line">        self.name = name</span><br><span class="line">        self.<span class="built_in">next</span> = <span class="literal">None</span></span><br><span class="line">        self.flag = <span class="number">0</span></span><br><span class="line">        self.fast = self</span><br><span class="line">        self.slow = self</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__iter__</span>(<span class="params">self</span>):</span><br><span class="line">        loop = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">while</span> loop:</span><br><span class="line">            <span class="keyword">yield</span> self.flag</span><br><span class="line">            <span class="keyword">if</span> self.flag == <span class="number">1</span>:</span><br><span class="line">                loop = <span class="literal">False</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">elif</span> self.flag == <span class="number">2</span>:</span><br><span class="line">                loop = <span class="literal">False</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                self.fast = self.fast.<span class="built_in">next</span>.<span class="built_in">next</span></span><br><span class="line">                self.slow = self.slow.<span class="built_in">next</span></span><br><span class="line">            <span class="keyword">except</span> AttributeError:</span><br><span class="line">                self.flag = <span class="number">2</span></span><br><span class="line">            <span class="keyword">if</span> self.fast == self.slow:</span><br><span class="line">                self.flag = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    node1 = Node(<span class="string">&quot;first&quot;</span>)</span><br><span class="line">    node2 = Node(<span class="string">&quot;second&quot;</span>)</span><br><span class="line">    node3 = Node(<span class="string">&quot;third&quot;</span>)</span><br><span class="line"></span><br><span class="line">    node1.<span class="built_in">next</span> = node2</span><br><span class="line">    node2.<span class="built_in">next</span> = node3</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> node1:</span><br><span class="line">        <span class="keyword">if</span> i == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">elif</span> i == <span class="number">1</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;该链表是环链表&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;该链表不是环链表&quot;</span>)</span><br><span class="line"></span><br><span class="line">    node1 = Node(<span class="string">&quot;first&quot;</span>)</span><br><span class="line">    node2 = Node(<span class="string">&quot;second&quot;</span>)</span><br><span class="line">    node3 = Node(<span class="string">&quot;third&quot;</span>)</span><br><span class="line"></span><br><span class="line">    node1.<span class="built_in">next</span> = node2</span><br><span class="line">    node2.<span class="built_in">next</span> = node3</span><br><span class="line">    node3.<span class="built_in">next</span> = node1</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> node1:</span><br><span class="line">        <span class="keyword">if</span> i == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">elif</span> i == <span class="number">1</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;该链表是环链表&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;该链表不是环链表&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>返回</p>
<p><img src="/./images/python/iterator/25.png"></p>

        </article>
        <section class="post-near">
            <ul>
                
                    <li>上一篇: <a href="/2022/12/10/python/python%20%E5%86%85%E5%AD%98%E8%AF%A6%E8%A7%A3/">python 内存详解</a></li>
                
                
                    <li>下一篇: <a href="/2022/12/08/python/python%20%E5%87%BD%E6%95%B0%E8%AF%A6%E8%A7%A3/">python 函数详解</a></li>
                
            </ul>
        </section>
        
            <section class="post-tags">
            <a class="-none-link" href="/tags/python/" rel="tag">python</a><a class="-none-link" href="/tags/%E8%BF%AD%E4%BB%A3%E5%99%A8%E5%92%8C%E7%94%9F%E6%88%90%E5%99%A8/" rel="tag">迭代器和生成器</a>
            </section>
        
    
        <section class="post-author">
        
            <figure class="author-avatar">
                <img src="/images/images/myhead.png" alt="Junliangl" />
            </figure>
        
            <div class="author-info">
                <h4>Junliangl</h4>
                <p style="color: #e6cfe6">我是一个软件测试工程师，感兴趣可以查看
				    <a target="_blank" rel="noopener" href="https://github.com/junliangl">我的github</a>
					 本站采用
					<a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">CC BY-NC-SA 4.0</a>
					 协议，转载请注明来源，谢谢!
				</p>
            </div>
        </section>
    
    </div>
</main>

    <footer>
    <div class="buttons">
        <a class="to-top" href="#"></a>
    </div>
    <div class="wrap min">
        <section class="widget">
            <div class="row">
                <div class="col-m-4">
                    <h3 class="title-recent">最新文章：</h3>
                    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2022/12/10/python/python%20%E7%B1%BB%E8%AF%A6%E8%A7%A3/">python 类详解</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/12/10/python/python%20%E5%86%85%E5%AD%98%E8%AF%A6%E8%A7%A3/">python 内存详解</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/12/10/python/python%20%E8%BF%AD%E4%BB%A3%E5%99%A8%E5%92%8C%E7%94%9F%E6%88%90%E5%99%A8/">python 迭代器和生成器</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/12/08/python/python%20%E5%87%BD%E6%95%B0%E8%AF%A6%E8%A7%A3/">python 函数详解</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/12/08/python/python%20%E9%A9%BB%E7%95%99%E6%9C%BA%E5%88%B6/">python 驻留机制</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/12/08/python/python%20%E5%BE%AA%E7%8E%AF%E6%8E%A7%E5%88%B6%20break%20%E5%92%8C%20continue/">python 循环控制 break 和 continue</a></li></ul>
                </div>
                <div class="col-m-4">
                    <h3 class="title-date">历史：</h3>
                    <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/12/">十二月 2022</a></li></ul>
                </div>
                <div class="col-m-4">
                    <h3 class="title-tags">标签云：</h3>
                    <a href="/tags/continer/" style="font-size: 1020;">continer</a> <a href="/tags/pytest/" style="font-size: 1020;">pytest</a> <a href="/tags/python/" style="font-size: 2020;">python</a> <a href="/tags/%E5%86%85%E5%AD%98%E6%9C%BA%E5%88%B6/" style="font-size: 1020;">内存机制</a> <a href="/tags/%E5%87%BD%E6%95%B0/" style="font-size: 1020;">函数</a> <a href="/tags/%E5%8F%98%E9%87%8F/" style="font-size: 1020;">变量</a> <a href="/tags/%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/" style="font-size: 1020;">基本数据类型</a> <a href="/tags/%E5%AD%97%E7%AC%A6%E4%B8%B2/" style="font-size: 1020;">字符串</a> <a href="/tags/%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95/" style="font-size: 1520;">常用方法</a> <a href="/tags/%E5%BC%80%E5%8F%91%E6%A8%A1%E5%9E%8B/" style="font-size: 1020;">开发模型</a> <a href="/tags/%E5%BE%AA%E7%8E%AF/" style="font-size: 1020;">循环</a> <a href="/tags/%E6%96%B9%E6%B3%95/" style="font-size: 1020;">方法</a> <a href="/tags/%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7/" style="font-size: 1520;">测试工具</a> <a href="/tags/%E6%B5%8B%E8%AF%95%E7%94%A8%E4%BE%8B/" style="font-size: 1020;">测试用例</a> <a href="/tags/%E6%B5%8B%E8%AF%95%E7%94%A8%E4%BE%8B%E8%AE%BE%E8%AE%A1/" style="font-size: 1020;">测试用例设计</a> <a href="/tags/%E7%B1%BB/" style="font-size: 1020;">类</a> <a href="/tags/%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83/" style="font-size: 1020;">虚拟环境</a> <a href="/tags/%E8%B4%A8%E9%87%8F%E6%A8%A1%E5%9E%8B/" style="font-size: 1020;">质量模型</a> <a href="/tags/%E8%BF%90%E7%AE%97%E7%AC%A6/" style="font-size: 1020;">运算符</a> <a href="/tags/%E8%BF%AD%E4%BB%A3%E5%99%A8%E5%92%8C%E7%94%9F%E6%88%90%E5%99%A8/" style="font-size: 1020;">迭代器和生成器</a>
                </div>
            </div>
        </section>
        <section class="sub-footer">
            <p>© 2022 <a href="/">onepiece</a>. All Rights Reserved. Theme By <a href="https://github.com/Dreamer-Paul/Hingle" target="_blank" rel="nofollow">Hingle</a>.</p>
        </section>
    </div>
</footer>


<script src="/static/kico.js"></script>
<script src="/static/hingle.js"></script>


<script>var hingle = new Paul_Hingle({"copyright":true,"night":true});</script>

  </body>
</html>
